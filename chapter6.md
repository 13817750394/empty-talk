1. ##前言

2. ##相关模型和相关引擎
   万事万物之间都有关联，本节将建立一个描述各事物之间相互关系的模型，并描述一个系统可以将相关性进行管理和查询的系统。
   
   1. ###相关模型
      ![](conan/0.0.uxf.png)
      * 如图，有三个集合 A B C，可以通过一个方法判断两两之间的某个元素是否相关，那么选取其中的元素 a b c，如果判断出 ab ac bc 都相关，那么我们可以认为 a b c 是相关的。如果只有 AB 和 BC 存在相关性，那么可以通过判断 ab 和 bc 是否相关来确定 abc 是否相关。
      * 可以将上面的例子推广：
         1. 集合 F {F(1),F(2),...,F(n)} 为源集合, 其中 F() 为数据集合, 对于 F ,其中每个 F() 中选取的任意一个对象 组成 f {f(1),f(2),...,f(n)} 元素集合, 其中 f() 为元素。
         2. f 任选 x 个对象的组合 y(x) {y(x,1),y(x,2),...,y(x,C(x,n))} 为x元集合, 其中 y(x,) 命名为 x元子, 可以预见 y(1)===f .
         3. 在 y(2) 中选择 m 个 y(2,) 组成 d { d(1),d(2),...,d(m) } 为主可判2元子集合, d() 为可判2元子.
         4. 函数集合 L {L(1,),L(2,),...,L(m,)} 为二元相关函数集合, L(,)为二元相关函数，对每个  L(i,d(i)) 可得一个 [0,1] 的值，这个值说明 d(i) 包含的两个元素之间在 L 上的相关量.
         5. 主相关二元子集合 p { p(1),p(2),...,p(w) } 是 d 的子集, 是由 d 中在 L 上的相关量都大于最小相关量 v 的对象组成.
         6. 对于y(x,)中的x个元素, x 中选2组成 q {q(x,,1),q(x,,2),...,q(x,,c(2,x)} 为待判x元子集合, q(x,,)为待判x元子, 如果q中的对象在d中出现就必然也在p中出现,则y(x,)为相关x元子. 可以预见当x=2的时候, 相关2元子一定在 p 中.

   2. ###相关引擎【Conan】
      ![](conan/0.1.uxf.png)
      本文设计的相关引擎可以快速的根据预设的若干个数据集之间的关系查询相关的数据：
         1. 以相关性集合L作为输入。
         2. 可以插入和删除L中描述的数据集合，系统会对数据进行存储和索引。
         3. 可以根据某个数据集中的元素快速查询使L成立的其他数据集的组合。
		 4. 系统提供同步某数据集合组合变化的通道.
      当然，真实系统会随着n的个数增加而计算量剧烈增长，因此实际应用中会限制n的个数，并将数据分片存储。

3. ##相关性的分层结构
   为了能够使Conan存储并索引到A集合中各个子集合之间的关系，并能快速根据条件查询任何一个符合L的子集，我们将相关模型分层构建。
   
   1. ###相关性分层
      ![](conan/1.0.uxf.png)
      我们先看一个三个集合的例子，A B C三个集合，两两之间可能相关或者不相关，如relation1，relation2，relation3，其中relation1情况下，ABC 三者不相关。而relation3是最负杂相关性的例子，上图是relation3的分层结构。
         1. 如果集合个数为 n ,整体则分为 n 大层，从 leve 1 ~ leve n。
         2. 第 x 层处理 x 个集合的相关组合是否与另一个不在该组合中的集合相关的情况，如 level 1 处理A集合与B集合是否相关的情况，而 level 2 处理 AxB 集合相关组合与 C 集合是否相关的情况。
         3. 每个大层分为两个小层 leve n.0 level n.1。
         4. 0小层为关键词索引层，关键词索引可以快速的根据某个查询条件查出该层某个相关组合的元素,也可以作为一个元素与该层的相关组合集合中的元素是否相关的预判方法.
         5. 1小层为推进索引层，记录该层相关组合和不在这个组合中的集合的相关性。
         6. 特别的，对于最后一层，只有0小层，没有1小层，最后一层不需要再往下推进了。

   2. ###相关集合和剩余集合
      ![](conan/2.0.uxf.png)
	  d

4. ##层的操作
![](conan/3.0.uxf.png)
![](conan/3.1.uxf.png)
![](conan/3.2.uxf.png)

5. ##存储和查询
![](conan/4.0.uxf.png)

6. ##检索结构
![](conan/5.0.uxf.png)
![](conan/6.0.uxf.png)

7. ##检索结构的合并
![](conan/7.0.uxf.png)
![](conan/7.1.uxf.png)
![](conan/8.0.uxf.png)

8. ##分片与归并
![](conan/9.0.uxf.png)

9. ##折中方案